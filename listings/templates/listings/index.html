{% extends 'base.html' %}

{% block head %}
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/1.7.2/jquery.min.js"></script>
    <meta name="viewport" content="initial-scale=1.0, user-scalable=no">
    <meta charset="utf-8">
    <title>AirBook</title>
    <style>
          #map {
        height: 100%;
      }
      /* Optional: Makes the sample page fill the window. */
      html, body {
        height: 100%;
        margin: 0;
        padding: 0;
      }
    </style>
{% endblock %}

{% block content %}
    <div class="container">
            <div class="row">
                <div class="col-sm-5">
                <input id='keyword' name='keyword' class="form-control" placeholder="Enter your location">
                </div>
                <div class="col-md-2">
                    <select class="form-control" name="roomtype" onchange="getRoomType(this.value)">
                        <option selected="selected" disabled>Room Type</option>
                        <option value="Shared room">Shared room</option>
                        <option value="Private room">Private room</option>
                        <option value="Entire home/apt">Entire home/apt</option>
                    </select>
                </div>
                <button type="submit" class="btn btn-primary" value="Submit" onclick="searchKeyWord()">Submit</button>
            </div>
    </div>
    <br/>
    <div id="map", class="container"></div>
     <script>
        var map;
        var markers = [];
        function initMap() {   //init map
            map = new google.maps.Map(document.getElementById('map'), {
                zoom: 4,
                center: new google.maps.LatLng(40.694439, -73.986536),
                mapTypeId: 'terrain'
            });
            //add
            google.maps.event.addListener(map, 'click', function (event) {
                latLong = event.latLng;
                update_timeout = setTimeout(function () {
                    coordinates = event.latLng;
                    latitude = coordinates['lat']();
                    longitude = coordinates['lng']();
                    this.map.setCenter(latLong);
                    this.map.setZoom(6);
                }, 200);
            });
            //Ignore double clicks
            google.maps.event.addListener(map, 'dblclick', function (event) {
                clearTimeout(update_timeout);
            });
        }

        function getRoomType(keyWord) {
            roomtype = keyWord;
        }

        function searchKeyWord() {
            var keyword = document.getElementsByName("keyword")[0].value;

            if(keyword != undefined && roomtype != undefined){
                var url = 'json/'.concat(keyword).concat('/').concat(roomtype).concat('/');
                $.getJSON(url,parseJSON);
            }
        }

        function parseJSON(data, status, xhr) {
            for (var i = 0; i < data.length; i++){
                var id = data[i]['properties']['id'];
                var marker = new google.maps.Marker({
                    icon: {
                        path: google.maps.SymbolPath.CIRCLE,
                        scale: 2,
                        fillOpacity: 1,
                        fillColor: "#ff332c",
                        strokeColor: "#ff332c"
                    },
                    position: {lat: parseFloat(data[i]['geometry']['coordinates'][0]), lng: parseFloat(data[i]['geometry']['coordinates'][1])},
                    map: map,
                    id: id
                });
                markers.push(marker);
            }
        }
    </script>
    <script async defer
    src="https://maps.googleapis.com/maps/api/js?key=AIzaSyAzqsrd9qkXn7qoQSJJwCkhIMM77OffJSI&callback=initMap">
    </script>
{% endblock %}